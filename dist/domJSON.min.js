!function(e,t){if("function"==typeof define&&define.amd)define(function(){return t(e)});else if("undefined"!=typeof exports){var r=t(e);"undefined"!=typeof module&&module.exports&&(module.exports=r),exports=dmoJSON}else window.domJSON=t(e)}(this,function(e){"use strict";var t={},r={domain:e.location.href||null,userAgent:window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null,version:"0.1.0"},n={absolutePaths:["action","data","href","src"],attributes:!0,computedStyle:!1,cull:!0,deep:!0,filter:!1,htmlOnly:!1,metadata:!0,serialProperties:!1,stringify:!1},o={noMeta:!1},a=["link","script"],i=["nodeType","nodeValue","tagName"],s=["attributes","childNodes","children","classList","dataset","style"],u=["innerHTML","innerText","outerHTML","outerText","prefix","text","textContent","wholeText"],l=function(e){if(!arguments.length)return arguments[0]||{};for(var t in arguments[1])e[t]=arguments[1][t];if(arguments.length>2){var r=[e].concat(Array.prototype.slice.call(arguments,2));return l.apply(null,r)}return e},c=function(){if(!arguments.length)return[];for(var e=Array.prototype.concat.apply([],arguments),t=0;t<e.length;t++)e.indexOf(e[t])<t&&(e.splice(t,1),t--);return e},f=function(e){if(e instanceof Array)return e.slice();var t={};for(var r in e)t[r]=e[r];return t},d=function(e,t){var r;if(e instanceof Array)r=c(e.filter(function(e){return t.indexOf(e)>-1}));else{r={};for(var n in t)e.hasOwnProperty(t[n])&&(r[t[n]]=e[t[n]])}return r},p=function(e,t){var r;if(e instanceof Array)r=c(e.filter(function(e){return-1===t.indexOf(e)}));else{r={};for(var n in e)r[n]=e[n];for(var o in t)r.hasOwnProperty(t[o])&&delete r[t[o]]}return r},y=function(e,t){return t===!1?e instanceof Array?[]:{}:t instanceof Array&&t.length?"boolean"==typeof t[0]?1==t.length&&"boolean"==typeof t[0]?t[0]===!0?f(e):e instanceof Array?[]:{}:t[0]===!0?p(e,t.slice(1)):d(e,t.slice(1)):d(e,t):f(e)},m=function(e){var t;return"boolean"==typeof e?e:"object"==typeof e&&null!==e?e instanceof Array?e.filter(function(e,t){return"string"==typeof e||0===t&&e===!0?!0:!1}):e.values instanceof Array?(t=e.values.filter(function(e){return"string"==typeof e?!0:!1}),t.length?(e.exclude&&t.unshift(e.exclude),t):!1):!1:e?!0:!1},g=function(e,t){var r,n,o;if(e.match(/(?:^data\:|^[\w\-\+\.]*?\:\/\/|^\/\/)/i))return e;if("/"===e.charAt(0))return t+e.substr(1);r=t.indexOf("://")>-1?t.substring(0,t.indexOf("://")+3):"",n=(r.length?t.substring(r.length):t).split("/"),o=e.split("/"),n.pop();for(var a=0;a<o.length;a++)"."!=o[a]&&(".."==o[a]?n.length>1&&n.pop():n.push(o[a]));return r+n.join("/")},h=function(e,t){var r={};for(var n in e)e.hasOwnProperty(n)&&"function"!=typeof e[n]&&(!(e[n]instanceof Object)||e[n]instanceof Array)&&(t.cull?(e[n]||0===e[n]||e[n]===!1)&&(r[n]=e[n]):r[n]=e[n]);return r=y(r,t.domProperties)},v=function(e,t){for(var r,n={},o=e.attributes,a=o.length,i=0;a>i;i++)n[o[i].name]=o[i].value;n=t.attributes?y(n,t.attributes):null,r=y(n,t.absolutePaths);for(var i in r)n[i]=g(r[i],t.absoluteBase);return n},b=function(t,r){var n,o={};if(!(r.computedStyle&&t.style instanceof CSSStyleDeclaration))return null;n=e.getComputedStyle(t);for(var a in n)"cssText"!==a&&!a.match(/\d/)&&"string"==typeof n[a]&&n[a].length&&(o[a]=n[a]);return r.computedStyle instanceof Array?y(o,r.computedStyle):o},P=function(e,t,r){var n,o,i,s,u,l=h(e,t);if(1===e.nodeType){for(var c in a)if(e.tagName.toLowerCase()===a[c])return null}else if(3===e.nodeType&&!e.nodeValue.trim())return null;if(t.attributes&&e.hasOwnProperty("attributes")&&(l.attributes=v(e,t)),t.computedStyle&&(n=b(e,t))&&(l.style=n),t.deep===!0||"number"==typeof t.deep&&t.deep>r){u=[],o=t.htmlOnly?e.children:e.childNodes,i=o.length;for(var f=0;i>f;f++)s=P(o[f],t,r+1),s&&u.push(s);l.childNodes=u}return l};t.toJSON=function(t,o){var a,f={},y={},g=(new Date).getTime(),h=i.slice(),v=s.slice();return f=l({},n,o),f.absolutePaths=m(f.absolutePaths),f.attributes=m(f.attributes),f.computedStyle=m(f.computedStyle),f.domProperties=m(f.domProperties),f.serialProperties=m(f.serialProperties),f.absoluteBase=e.location.origin+"/",f.serialProperties!==!0&&(v=v.concat(f.serialProperties instanceof Array&&f.serialProperties.length?f.serialProperties[0]===!0?p(u,f.serialProperties):d(u,f.serialProperties):u)),f.domProperties=f.domProperties instanceof Array?f.domProperties[0]===!0?p(c(f.domProperties,v),h):p(c(f.domProperties,h),v):[!0].concat(v),a=P(t,f,0),f.metadata?(y.meta=l({},r,{options:f,clock:(new Date).getTime()-g}),y.node=a):y=a,f.stringify?JSON.stringify(y):y};var w=function(e,t,r){switch(t instanceof DocumentFragment&&(t=t.ownerDocument),e){case 1:return"string"==typeof r.tagName?t.createElement(r.tagName):!1;case 3:return t.createTextNode("string"==typeof r.nodeValue&&r.nodeValue.length?r.nodeValue:"");case 7:return r.hasOwnProperty("target")&&r.hasOwnProperty("data")?t.createProcessingInstruction(r.target,r.data):!1;case 8:return t.createComment("string"==typeof r.nodeValue?r.nodeValue:"");case 9:return t.implementation.createHTMLDocument(r);case 10:return r.hasOwnProperty("name")&&r.hasOwnProperty("publicId")&&r.hasOwnProperty("systemId")?t.implementation.createDocumentType(r.name,r.publicId,r.systemId):!1;case 11:return t;default:return!1}},O=function(e,t,r){if(!e.nodeType)return!1;var n=w(e.nodeType,r,e);t.appendChild(n);for(var o in e)e[o]instanceof Object||(n[o]=e[o]);if(1===e.nodeType&&e.tagName&&e.attributes)for(var a in e.attributes)n.setAttribute(a,e.attributes[a]);if(e.childNodes&&e.childNodes.length)for(var i in e.childNodes)O(e.childNodes[i],n,r)};return t.toDOM=function(e,t){var r,n;return"string"==typeof e&&(e=JSON.parse(e)),r=l({},o,t),n=document.createDocumentFragment(),r.noMeta?O(e,n,n):O(e.node,n,n),n},t});